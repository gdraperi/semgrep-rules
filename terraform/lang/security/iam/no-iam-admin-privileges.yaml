rules:
- id: no-iam-admin-privileges
  patterns:
  - pattern-inside: |
      resource "$TYPE" "..." {
        ...
        policy = jsonencode({
          ...
          Statement = [
            ...
          ]
          ...
        })
        ...
      }
  - pattern: |
      Action = "*"
      ...
      Effect = "Allow"
      ...
      Resource = "*"
  - metavariable-pattern:
      metavariable: $TYPE
      pattern-either:
      - pattern: aws_iam_role_policy
      - pattern: aws_iam_policy
      - pattern: aws_iam_user_policy
      - pattern: aws_iam_group_policy
  message: |
    IAM policies that allow full "*-*" admin privileges should most likely
    not be created. This violates the principle of least privilege. Instead, give each user
    more fine-grained control with only the privileges they need.
  metadata:
    references:
    - https://github.com/bridgecrewio/checkov/blob/master/checkov/terraform/checks/data/aws/AdminPolicyDocument.py
    category: security
    cwe: 'CWE-269: Improper Privilege Management'
    license: Commons Clause License Condition v1.0[LGPL-2.1-only]
  paths:
    include:
    - '*.tf'
  languages: [generic]
  severity: WARNING
